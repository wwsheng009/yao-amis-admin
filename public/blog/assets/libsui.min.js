var L=Object.defineProperty;var E=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var A=(r,t,e)=>t in r?L(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,S=(r,t)=>{for(var e in t||(t={}))C.call(t,e)&&A(r,e,t[e]);if(E)for(var e of E(t))j.call(t,e)&&A(r,e,t[e]);return r};var p=(r,t,e)=>A(r,typeof t!="symbol"?t+"":t,e);var d=(r,t,e)=>new Promise((n,o)=>{var s=u=>{try{a(e.next(u))}catch(c){o(c)}},i=u=>{try{a(e.throw(u))}catch(c){o(c)}},a=u=>u.done?n(u.value):Promise.resolve(u.value).then(s,i);a((e=e.apply(r,t)).next())});function $$(r){let t=null;if(typeof r=="string"&&(t=document.querySelector(r)),r instanceof HTMLElement&&(t=r),t){const e=t.getAttribute("s:cn");if(e&&e!=""&&typeof window[e]=="function"){const n=new window[e](t);return new __sui_component(t,n)}}return null}function __sui_component_root(r,t){return r.closest(`[s\\:cn=${t}]`)}function __sui_state(r){this.handlers=r.watch||{},this.Set=function(t,e,n){return d(this,null,function*(){var s;const o=this.handlers[t];if(n=n||r.root,o&&typeof o=="function"){if(yield o(e,{target:n,stopPropagation:function(){n.setAttribute("state-propagation","true")}}),n?n.getAttribute("state-propagation")==="true":!1)return;let u=(s=r.root.parentElement)==null?void 0:s.closest("[s\\:cn]");if(u==null)return;const c=new CustomEvent("state:change",{detail:{key:t,value:e,target:r.root}});u.dispatchEvent(c)}})}}function __sui_props(r){this.Get=function(t){if(!r||typeof r.getAttribute!="function")return null;const e="prop:"+t,n=r.getAttribute(e);if(r.getAttribute("json-attr-prop:"+t)==="true")try{return JSON.parse(n)}catch(s){return null}return n},this.List=function(){const t={};if(!r||typeof r.getAttribute!="function")return t;const e=r.attributes;for(let n=0;n<e.length;n++){const o=e[n];if(o.name.startsWith("prop:")){const s=o.name.replace("prop:","");if(r.getAttribute("json-attr-prop:"+s)==="true"){try{t[s]=JSON.parse(o.value)}catch(a){t[s]=null}continue}t[s]=o.value}}return t}}function __sui_component(r,t){this.root=r,this.store=new __sui_store(r),this.props=new __sui_props(r),this.state=t?new __sui_state(t):{};const e=this;this.$root=new __Query(this.root),this.find=function(n){return new __Query(e.root).find(n)},this.query=function(n){return e.root.querySelector(n)},this.queryAll=function(n){return e.root.querySelectorAll(n)},this.emit=function(n,o){const s=new CustomEvent(n,{detail:o});e.root.dispatchEvent(s)},this.render=function(n,o,s){return new __Render(e,s).Exec(n,o)}}function __sui_event_handler(r,t,e,n,o,s){const i={};n=n||null,n&&(t.forEach(function(a){const u=n.getAttribute("data:"+a);i[a]=u}),e.forEach(function(a){const u=n.getAttribute("json:"+a);if(i[a]=null,u&&u!="")try{i[a]=JSON.parse(u)}catch(c){const l=c.message||c||"An error occurred";console.error(`[SUI] Event Handler Error: ${l} `,n)}})),s&&s(r,i,{rootElement:o,targetElement:n})}function __sui_event_init(r){const t=o=>{const s=o.getAttribute("s:event-cn")||"";if(s==""){console.error("[SUI] Component name is required for event binding",r);return}const i={},a=[],u=[];for(let c=0;c<o.attributes.length;c++)if(o.attributes[c].name.startsWith("data:")&&a.push(o.attributes[c].name.replace("data:","")),o.attributes[c].name.startsWith("json:")&&u.push(o.attributes[c].name.replace("json:","")),o.attributes[c].name.startsWith("s:on-")){const l=o.attributes[c].name.replace("s:on-","");i[l]=o.attributes[c].value}for(const c in i){const l=i[c];if(s=="__page"){const y=window[l],m=document.body,b=o;o.addEventListener(c,v=>{__sui_event_handler(v,a,u,b,m,y)});continue}const h=o.closest(`[s\\:cn=${s}]`);if(typeof window[s]!="function"){console.error(`[SUI] Component ${s} not found`,o);return}const g=new window[s](h),w=g[l],_=g.root,f=o;o.addEventListener(c,y=>{__sui_event_handler(y,a,u,f,_,w)})}},e=r.querySelectorAll("[s\\:event]"),n=r.querySelectorAll("[s\\:event-jit]");e.forEach(o=>t(o)),n.forEach(o=>t(o))}function __sui_store(r){r=r||document.body,this.Get=function(t){return r.getAttribute("data:"+t)},this.Set=function(t,e){r.setAttribute("data:"+t,e)},this.GetJSON=function(t){const e=r.getAttribute("json:"+t);if(e&&e!="")try{return JSON.parse(e)}catch(n){const o=n.message||n||"An error occurred";return console.error(`[SUI] Event Handler Error: ${o}`,r),null}return null},this.SetJSON=function(t,e){r.setAttribute("json:"+t,JSON.stringify(e))},this.GetData=function(){return this.GetJSON("__component_data")||{}}}function __sui_backend_call(r,t,e,...n){return d(this,null,function*(){const o=`/api/__yao/sui/v1/run${r}`;t=S({"Content-Type":"application/json",Referer:window.location.href,Cookie:document.cookie},t);const s={method:e,args:n};try{const i=JSON.stringify(s),a=yield fetch(o,{method:"POST",headers:t,body:i}),u=yield a.text();let c=null;if(u&&u!=""&&(c=JSON.parse(u)),a.status>=400){const l=c.message?c.message:`Failed to call ${r} ${e}`,h=c.code?c.code:500;return Promise.reject({message:l,code:h})}return Promise.resolve(c)}catch(i){const a=i.message?i.message:`Failed to call ${r} ${e}`,u=i.code?i.code:500;return console.error(`[SUI] Failed to call ${r} ${e}:`,i),Promise.reject({message:a,code:u})}})}function __sui_render(r,t,e,n){return d(this,null,function*(){const o=typeof r=="object"?r:$$(r);if(o==null)return console.error(`[SUI] Component not found: ${r}`),Promise.reject("Component not found");const s=o.root.querySelectorAll(`[s\\:render=${t}]`);if(!s.length)return console.error(`[SUI] No element found with s:render=${t}`),Promise.reject("No element found");n=n||{},n.replace=n.replace===void 0?!0:n.replace,n.showLoader=n.showLoader===void 0?!1:n.showLoader,n.withPageData=n.withPageData===void 0?!1:n.withPageData;let i='<span class="sui-render-loading">Loading...</span>';n.showLoader&&n.replace&&(typeof n.showLoader=="string"?i=n.showLoader:n.showLoader instanceof HTMLElement&&(i=n.showLoader.outerHTML),s.forEach(f=>f.innerHTML=i));let a=o.store.GetData()||{};n.withPageData&&(a=S(S({},a),__sui_data));const u=o.root.closest("[s\\:route]"),c=u?u.getAttribute("s:route"):!1,l=document.body.getAttribute("s:public")||"",h=c?`${l}${c}`:window.location.pathname;n.component=c&&o.root.getAttribute("s:cn")||"";const g=`/api/__yao/sui/v1/render${h}`,w={name:t,data:a,option:n};if(e)for(const f in e)w.data[f]=e[f];const _={"Content-Type":"application/json",Cookie:document.cookie};try{const f=JSON.stringify(w),m=yield(yield fetch(g,{method:"POST",headers:_,body:f})).text();return n.replace&&s.forEach(b=>{b.innerHTML=m;try{__sui_event_init(b)}catch(v){const $=v.message||"Failed to init events";Promise.reject($)}}),Promise.resolve(m)}catch(f){return s.forEach(y=>{y.innerHTML='<span class="sui-render-error">Failed to render</span>',console.error("Failed to render",f)}),Promise.reject("Failed to render")}})}function $Store(r){if(!r)return null;if(typeof r=="string"){if(r=document.querySelectorAll(r),r.length==0)return null;r=r[0]}return new __sui_store(r)}function $Query(r){return new __Query(r)}class __Query{constructor(t){p(this,"selector","");p(this,"elements",null);p(this,"element",null);typeof t=="string"?(this.selector=t,this.elements=document.querySelectorAll(t),this.elements.length>0&&(this.element=this.elements[0])):t instanceof NodeList?(this.elements=t,this.elements.length>0&&(this.element=this.elements[0])):this.element=t,this.selector=t}elm(){return this.element}elms(){return this.elements}find(t){var n;const e=(n=this.element)==null?void 0:n.querySelector(t);return e?new __Query(e):null}findAll(t){var n;const e=(n=this.element)==null?void 0:n.querySelectorAll(t);return e?new __Query(e):null}closest(t){var n;const e=(n=this.element)==null?void 0:n.closest(t);return e?new __Query(e):null}on(t,e){return this.element?(this.element.addEventListener(t,e),this):this}$$(){if(!this.element)return null;const t=this.element.closest("[s\\:cn]");return t?$$(t):null}each(t){this.elements&&this.elements.forEach((e,n)=>{t(new __Query(e),n)})}store(){return!this.element||typeof this.element.getAttribute!="function"?null:new __sui_store(this.element)}attr(t){return!this.element||typeof this.element.getAttribute!="function"?null:this.element.getAttribute(t)}data(t){return!this.element||typeof this.element.getAttribute!="function"?null:this.element.getAttribute("data:"+t)}json(t){if(!this.element||typeof this.element.getAttribute!="function")return null;const e=this.element.getAttribute("json:"+t);if(!e)return null;try{return JSON.parse(e)}catch(n){return console.error(`Error parsing JSON for key ${t}: ${n}`),null}}prop(t){if(!this.element||typeof this.element.getAttribute!="function")return null;const e="prop:"+t,n=this.element.getAttribute(e);if(this.element.getAttribute("json-attr-prop:"+t)==="true"&&n)try{return JSON.parse(n)}catch(s){return console.error(`Error parsing JSON for prop ${t}: ${s}`),null}return n}hasClass(t){var e;return(e=this.element)==null?void 0:e.classList.contains(t)}toggleClass(t){const e=Array.isArray(t)?t:t==null?void 0:t.split(" ");return e==null||e.forEach(n=>{var s;const o=n.replace(/[\n\r\s]/g,"");o!==""&&((s=this.element)==null||s.classList.toggle(o))}),this}removeClass(t){const e=Array.isArray(t)?t:t==null?void 0:t.split(" ");return e==null||e.forEach(n=>{var s;const o=n.replace(/[\n\r\s]/g,"");o!==""&&((s=this.element)==null||s.classList.remove(o))}),this}addClass(t){const e=Array.isArray(t)?t:t==null?void 0:t.split(" ");return e==null||e.forEach(n=>{var s;const o=n.replace(/[\n\r\s]/g,"");o!==""&&((s=this.element)==null||s.classList.add(o))}),this}html(t){var e;return t===void 0?((e=this.element)==null?void 0:e.innerHTML)||"":(this.element&&(this.element.innerHTML=t),this)}}function $Render(r,t){return new __Render(r,t)}class __Render{constructor(t,e){p(this,"comp",null);p(this,"option",null);this.comp=t,this.option=e}Exec(t,e){return d(this,null,function*(){return __sui_render(this.comp,t,e,this.option)})}}function $Backend(r,t){const e=document.body.getAttribute("s:public")||"/";r=r||window.location.pathname;const n=new RegExp("^"+e);return r=e+r.replace(n,""),new __Backend(r,t)}class __Backend{constructor(t,e={}){p(this,"route","");p(this,"headers",{});this.route=t,this.headers=e}Call(t,...e){return d(this,null,function*(){return yield __sui_backend_call(this.route,this.headers,t,...e)})}}function Yao(r){this.host=`${r||window.location.protocol+"//"+window.location.host}/api`,this.query={},new URLSearchParams(window.location.search).forEach((t,e)=>{this.query[t]=e})}Yao.prototype.Get=function(r,t,e){return d(this,null,function*(){return this.Fetch("GET",r,t,null,e)})},Yao.prototype.Post=function(r,t,e,n){return d(this,null,function*(){return this.Fetch("POST",r,e,t,n)})},Yao.prototype.Download=function(r,t,e,n){return d(this,null,function*(){try{const s=yield this.Fetch("GET",r,t,null,n,!0);var o=window.URL.createObjectURL(s);let i=document.createElement("a");document.body.appendChild(i),i.href=o,i.download=e,i.click(),window.URL.revokeObjectURL(o)}catch(s){alert("\u6210\u529F\u521B\u5EFA\u5BFC\u51FA\u4EFB\u52A1!")}})},Yao.prototype.Fetch=function(r,t,e,n,o,s){return d(this,null,function*(){e=e||{},o=o||{},n=n||null;var i=`${this.host}${t}`,a=this.Serialize(e);a!=""&&(i=i.includes("?")?`${i}&${a}`:`${i}?${a}`);const u=this.Token();u!=""&&(o.authorization=`Bearer ${u}`),o["Content-Type"]||(o["Content-Type"]="application/json");var c={method:r,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:o,redirect:"follow"};n!=null&&(c.body=JSON.stringify(n));const l=yield fetch(i,c),h=l.headers.get("Content-Type")||"";if(h.includes("application/json"))try{return yield l.json()}catch(g){return{code:l.status,message:"empty return"}}else{if(s)return l.blob();if(h.includes("text/html")||h.includes("text/plain"))return l.text()}return l.text()})},Yao.prototype.Token=function(){var r=sessionStorage.getItem("token")||"";return r==""?this.Cookie("__tk")||"":r},Yao.prototype.Cookie=function(r){for(var t=r+"=",e=decodeURIComponent(document.cookie),n=e.split(";"),o=0;o<n.length;o++){var s=n[o].trim();if(s.indexOf(t)===0)return s.substring(t.length,s.length)}return null},Yao.prototype.SetCookie=function(r,t,e){e=e||30;var n=new Date;n.setTime(n.getTime()+e*24*60*60*1e3);var o="expires="+n.toUTCString();document.cookie=`${r}=${t};${o};path=/`},Yao.prototype.DeleteCookie=function(r){document.cookie=`${r}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`},Yao.prototype.Serialize=function(r){const t=[];for(const e in r)r.hasOwnProperty(e)&&t.push(encodeURIComponent(e)+"="+encodeURIComponent(r[e]));return t.join("&")};

//# sourceMappingURL=libsui.min.js.map